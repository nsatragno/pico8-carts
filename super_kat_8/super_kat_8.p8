pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
 state = "menu"
 i = 0
 player = {
  x = 64,
  y = 100,
  cd = 5,
 }
 stars = {}
 bullets = {}
 brushes = {{
  x = rnd(100) + 10,
  y = -10,
  hp = 8,
  dmg = false,
 }}
end

function _update60()
 if state == "menu" then
  if btnp(❎) or btnp(🅾️ ) then
   start_time = time()
   state = "game"
   return
  end
  return
 end

 -- game state
 timer = time() - start_time
 player.sprite = (time() * 5) % 4
 if btn(⬅️) then
  player.x -= 1
 end
 if btn(➡️) then
  player.x += 1
 end
 if btn(⬇️) then
  player.y += 1
 end
 if btn(⬆️) then
  player.y -= 1
 end
 if player.cd <= 0 and btn(🅾️ ) then
  player.cd = 10
  add(bullets, {
   x = player.x,
   y = player.y - 1
  })
 end
 player.x = mid(0, player.x, 127)
 player.y = mid(0, player.y, 127)
 player.cd = max(0, player.cd - 1)

 if flr(rnd() * 20) == 0 then
   add(stars, {
     x = rnd(127),
     y = 0,
     colour = flr(5 + rnd(3)),
   })
 end

 for star in all(stars) do
   star.y += 1
   if star.y > 128 then
    del(stars, star)
   end
 end

 for brush in all(brushes) do
  brush.dmg = false
  brush.y += 0.2
  if brush.y > 160 then
   del(brushes, brush)
  end
  for bullet in all(bullets) do
   if bullet.x >= brush.x - 2 and bullet.x <= brush.x + 1 and
      bullet.y >= brush.y - 3 and bullet.y <= brush.y + 4 then
    del(bullets, bullet)
    brush.dmg = true
    brush.hp -= 1
    if brush.hp <= 0 then
     del(brushes, brush)
    end
   end
  end
 end

 for bullet in all(bullets) do
  bullet.y -= 3
  if bullet.y < 0 then
   del(bullets, bullet)
  end
 end
end

function _draw()
 cls()

 if state == "menu" then
  print(" super kat 8 ", 40, 40, 7)
  print("press ❎ | 🅾️ ", 40, 60, 7)
  return
 end

 -- game
 for star in all(stars) do
   pset(star.x, star.y, star.colour)
 end

 for bullet in all(bullets) do
   pset(bullet.x, bullet.y, 2)
 end

 for brush in all(brushes) do
  if brush.dmg then
   pal({[12] = 8, [2] = 3})
  end
  spr(64 + flr(time() * 3) % 2, brush.x - 3, brush.y - 8, 1, 2)
  pal()
  --rectfill(brush.x - 2, brush.y - 3, brush.x + 1, brush.y + 4, 3)
 end

 spr(player.sprite, player.x - 3, player.y - 8, 1, 2)

 rectfill(player.x - 1, player.y - 1, player.x + 1, player.y + 1, 3)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00888000008880000088800000888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
088f8800088f8800088f8800088f8800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08fff80008fff80008fff80008fff800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88fff88008fff88088fff88088fff800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444400044444800444440084444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f444f000f444f000f444f000f444f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f444f000f444f000f444f000f444f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ff444ff0ff444ff0ff444ff0ff444ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444000004440000044400000444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00444000004440000044400000444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101000001010000010100000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101000001010000010100000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101000001010000010100000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101000001010000010100000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00404000004040000040400000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00110000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01cc100001cc10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01cc100001cc10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1ccc100001ccc1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1ccc100001ccc1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11441000014411000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04994000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444000044440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00440000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00440000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
